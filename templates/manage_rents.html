{% extends "base.html" %}
{% block title %}ç§Ÿå€Ÿç”³è«‹ç´€éŒ„{% endblock %}

{% block content %}
<style>
  .panel-card { border:0; border-radius:18px; box-shadow:0 12px 30px rgba(83,70,186,.08); }
  .panel-header{
    border-bottom:0; padding:24px 28px 12px;
    background:linear-gradient(135deg, rgba(131,93,255,.10), rgba(255,255,255,0));
    border-top-left-radius:18px; border-top-right-radius:18px;
  }
  .panel-title{ font-weight:800; letter-spacing:.5px; margin:0; }
  .table > :not(caption) > * > * { vertical-align: middle; }
</style>

<div class="container-fluid" style="margin-top:90px;">
  <div class="row justify-content-center">
    <div class="col-12 col-xl-10">

      <div class="card panel-card">
        <div class="panel-header">
          <h2 class="panel-title">ğŸ—“ï¸ ç§Ÿå€Ÿç”³è«‹ç´€éŒ„</h2>
        </div>

        <div class="card-body p-4 p-md-5">
          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th>ç”³è«‹æ™‚é–“</th>
                  <th>å ´åœ°</th>
                  <th>æ—¥æœŸ</th>
                  <th>æ™‚é–“</th>  {# ç”±ã€Œæ™‚æ®µã€æ”¹æˆã€Œæ™‚é–“ã€ #}
                  <th>è¯çµ¡äºº</th>
                  <th>é›»è©±</th>
                  <th>é›»å­éƒµä»¶</th>
                  <th>å‚™è¨»</th>
                  <th>ç‹€æ…‹</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                {% for r in rents %}
                <tr>
                  <td class="text-nowrap">{{ r.submitted_at|strftime("%Y-%m-%d %H:%M") }}</td>
                  <td>{{ r.location }}</td>
                  <td class="text-nowrap">{{ r.date|strftime("%Y-%m-%d") }}</td>

                  {# âœ… ç›¸å®¹é¡¯ç¤ºï¼šå„ªå…ˆç”¨ start_time/end_timeï¼›æ²’æœ‰å°±å¾ time_slot æ‹† #}
                  {% set s = r.start_time or (r.time_slot|replace('â€“','-')|split('-')[0]) %}
                  {% set e = r.end_time   or (r.time_slot|replace('â€“','-')|split('-')[1]) %}
                  <td class="text-nowrap">
                    {{ (s|string)[:5] }} â€“ {{ (e|string)[:5] }}
                  </td>

                  <td>{{ r.name }}</td>
                  <td class="text-nowrap">{{ r.phone }}</td>
                  <td>
                    {% if r.email %}
                      <a href="mailto:{{ r.email }}">{{ r.email }}</a>
                    {% else %}â€”{% endif %}
                  </td>
                  <td style="max-width:240px; white-space:pre-wrap;">{{ r.note or '' }}</td>
                  <td>
                    {% if r.status == 'pending' %}
                      <span class="badge text-bg-warning">å¯©æ ¸ä¸­</span>
                    {% elif r.status == 'approved' %}
                      <span class="badge text-bg-success">å·²æ ¸å‡†</span>
                    {% elif r.status == 'rejected' %}
                      <span class="badge text-bg-danger">å·²é§å›</span>
                    {% else %}
                      <span class="badge text-bg-secondary">{{ r.status }}</span>
                    {% endif %}
                  </td>
                  <td class="text-nowrap">
                    {% if r.status == 'pending' %}
                      <form action="{{ url_for('manage_rents') }}" method="POST" class="d-inline">
                        <input type="hidden" name="id" value="{{ r.id }}">
                        <input type="hidden" name="action" value="approve">
                        <button class="btn btn-success btn-sm">æ ¸å‡†</button>
                      </form>
                      <form action="{{ url_for('manage_rents') }}" method="POST" class="d-inline ms-1">
                        <input type="hidden" name="id" value="{{ r.id }}">
                        <input type="hidden" name="action" value="reject">
                        <button class="btn btn-danger btn-sm">é§å›</button>
                      </form>
                    {% else %}â€”{% endif %}
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="10" class="text-center text-muted py-5">ç›®å‰æ²’æœ‰ä»»ä½•ç”³è«‹ã€‚</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}
