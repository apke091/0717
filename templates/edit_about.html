{% extends "base.html" %}
{% block title %}ç·¨è¼¯é—œæ–¼æˆ‘å€‘{% endblock %}

{% block content %}
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script src="https://unpkg.com/quill-image-resize-module@3.0.0/image-resize.min.js"></script>

<!-- å­—å‹ï¼ˆå¯é¸ï¼Œè®“ä¸­æ–‡å­—çœ‹èµ·ä¾†ä¸€è‡´ï¼‰ -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">

<div class="container" style="margin-top: 90px">
  <h2>ç·¨è¼¯ã€Œé—œæ–¼æˆ‘å€‘ã€</h2>

  <form method="POST" onsubmit="return prepareForm();">
    <!-- ç·¨è¼¯å™¨ -->
    <div id="quill-editor" style="height: 500px; background:#fff; border:1px solid #ccc;"></div>
    <input type="hidden" name="content" id="hidden-content">

    <button type="submit" class="btn btn-success mt-3">ğŸ’¾ å„²å­˜</button>
    <a href="{{ url_for('about') }}" class="btn btn-secondary mt-3">å–æ¶ˆ</a>
  </form>
</div>

<style>
  /* åœ–ç‰‡è™•ç† */
  #quill-editor img { max-width: 100%; height: auto; }
  .ql-editor .ql-align-center img { display:block; margin:0 auto; }

  /* å­—é«”å¤§å°ä¸‹æ‹‰é¡¯ç¤ºæ–‡å­— */
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="12px"]::before,
  .ql-snow .ql-picker.ql-size .ql-picker-label[data-value="12px"]::before { content: "12px"; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="14px"]::before,
  .ql-snow .ql-picker.ql-size .ql-picker-label[data-value="14px"]::before { content: "14px"; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="18px"]::before,
  .ql-snow .ql-picker.ql-size .ql-picker-label[data-value="18px"]::before { content: "18px"; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="24px"]::before,
  .ql-snow .ql-picker.ql-size .ql-picker-label[data-value="24px"]::before { content: "24px"; }
  .ql-snow .ql-picker.ql-size .ql-picker-item[data-value="36px"]::before,
  .ql-snow .ql-picker.ql-size .ql-picker-label[data-value="36px"]::before { content: "36px"; }

  /* å­—å‹é¸å–®é¡¯ç¤ºåç¨±ï¼ˆç”¨è‡ªè¨‚ä»£è™Ÿï¼‰ */
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="msjh"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="msjh"]::before { content: "å¾®è»Ÿæ­£é»‘é«”"; }
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="noto"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="noto"]::before { content: "Noto Sans TC"; }
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="arial"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="arial"]::before { content: "Arial"; }
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="times"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="times"]::before { content: "Times New Roman"; }
  .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="courier"]::before,
  .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="courier"]::before { content: "Courier New"; }

  /* å¯¦éš›å¥—ç”¨å­—å‹ï¼ˆclass ç‰ˆï¼‰ */
  .ql-font-msjh    { font-family: "Microsoft JhengHei", "PingFang TC", "Heiti TC", sans-serif; }
  .ql-font-noto    { font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif; }
  .ql-font-arial   { font-family: Arial, Helvetica, sans-serif; }
  .ql-font-times   { font-family: "Times New Roman", Times, serif; }
  .ql-font-courier { font-family: "Courier New", Courier, monospace; }
</style>

<script>
  Quill.register('modules/imageResize', ImageResize);

  // å°ºå¯¸ç”¨ style attributor
  var Size = Quill.import('attributors/style/size');
  Size.whitelist = ['12px', '14px', '18px', '24px', '36px'];
  Quill.register(Size, true);

  // å­—å‹ç”¨ class attributor
  var Font = Quill.import('attributors/class/font');
  Font.whitelist = ['msjh', 'noto', 'arial', 'times', 'courier'];
  Quill.register(Font, true);

  const quill = new Quill('#quill-editor', {
    theme: 'snow',
    placeholder: 'è«‹è¼¸å…¥å…§å®¹...',
    modules: {
      toolbar: [
        [{ header: [1, 2, 3, false] }],
        [{ font: Font.whitelist }],
        [{ size: Size.whitelist }],
        ['bold', 'italic', 'underline'],
        [{ 'align': [] }],
        [{ list: 'ordered' }, { list: 'bullet' }],
        ['link', 'image', 'blockquote'],
        ['clean']
      ],
      imageResize: { modules: ['Resize', 'DisplaySize'] }
    },
    formats: [
      'header', 'font', 'size', 'bold', 'italic', 'underline',
      'align', 'list', 'link', 'image', 'blockquote'
    ]
  });

  // âœ… å®‰å…¨å¸¶å…¥å¾Œç«¯å…§å®¹
  const initial = {{ content | tojson }};
  quill.root.innerHTML = initial;

  function prepareForm() {
    document.getElementById('hidden-content').value = quill.root.innerHTML;
    return true;
  }
</script>
{% endblock %}
